

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Parcial Machine Learning Augusto Piñeres &#8212; Parcial ML</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Parcial_MachineLearning_AugustoP_1';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Este es el Examen Parcial de Machine Learning de Augusto Piñeres" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Este es el Examen Parcial de Machine Learning de Augusto Piñeres
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Parcial Machine Learning Augusto Piñeres</a></li>



</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FParcial_MachineLearning_AugustoP_1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Parcial_MachineLearning_AugustoP_1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Parcial Machine Learning Augusto Piñeres</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Parcial Machine Learning Augusto Piñeres</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fraud-detection">Fraud Detection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-speed">Wind Speed</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion">Modelo de Regresion</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion">Modelo de Clasificacion</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="parcial-machine-learning-augusto-pineres">
<h1>Parcial Machine Learning Augusto Piñeres<a class="headerlink" href="#parcial-machine-learning-augusto-pineres" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Librerias</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;frozen importlib._bootstrap&gt;:228: RuntimeWarning: scipy._lib.messagestream.MessageStream size changed, may indicate binary incompatibility. Expected 56 from C header, got 64 from PyObject
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="eda">
<h1>EDA<a class="headerlink" href="#eda" title="Permalink to this heading">#</a></h1>
<section id="fraud-detection">
<h2>Fraud Detection<a class="headerlink" href="#fraud-detection" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Leer datos </span>
<span class="n">train_transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;train_transaction.csv&quot;</span><span class="p">)</span>
<span class="n">train_identity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;train_identity.csv&quot;</span><span class="p">)</span>
<span class="n">test_transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;test_transaction.csv&quot;</span><span class="p">)</span>
<span class="n">test_identity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;test_identity.csv&quot;</span><span class="p">)</span>
<span class="n">train_data_transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">train_transactions</span><span class="p">,</span> <span class="n">train_identity</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;TransactionID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">test_data_transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">test_transactions</span><span class="p">,</span> <span class="n">test_identity</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;TransactionID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="c1">#Quiero ver las primeras 5 filas de train_data_transactions</span>
<span class="n">train_data_transactions</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_135556</span><span class="o">/</span><span class="mf">1839637349.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">#Leer datos</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">train_transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;train_transaction.csv&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">train_identity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;train_identity.csv&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">test_transactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;test_transaction.csv&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">test_identity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;test_identity.csv&quot;</span><span class="p">)</span>

<span class="nn">~\miniconda3\envs\ml_venv\lib\site-packages\pandas\util\_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\parsers\base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>         <span class="n">Let</span> <span class="n">the</span> <span class="n">readers</span> <span class="nb">open</span> <span class="n">IOHandles</span> <span class="n">after</span> <span class="n">they</span> <span class="n">are</span> <span class="n">done</span> <span class="k">with</span> <span class="n">their</span> <span class="n">potential</span> <span class="n">raises</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">222</span><span class="s2">         self.handles = get_handle(</span>
<span class="g g-Whitespace">    </span><span class="mi">223</span><span class="s2">             src,</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span><span class="s2">             &quot;r&quot;,</span>

<span class="nn">~\miniconda3\envs\ml_venv\lib\site-packages\pandas\io\common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">700</span><span class="s2">         if ioargs.encoding and &quot;b&quot; not in ioargs.mode:</span>
<span class="g g-Whitespace">    </span><span class="mi">701</span><span class="s2">             # Encoding</span>
<span class="ne">--&gt; </span><span class="mi">702</span><span class="s2">             handle = open(</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span><span class="s2">                 handle,</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span><span class="s2">                 ioargs.mode,</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;train_transaction.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a ver la cantidad de observaciones y variables para cada observacion</span>
<span class="n">train_data_transactions</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(590540, 434)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a ver las columnas con datos tipo float</span>
<span class="n">train_data_transactions</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;TransactionAmt&#39;, &#39;card2&#39;, &#39;card3&#39;, &#39;card5&#39;, &#39;addr1&#39;, &#39;addr2&#39;, &#39;dist1&#39;,
       &#39;dist2&#39;, &#39;C1&#39;, &#39;C2&#39;,
       ...
       &#39;id_17&#39;, &#39;id_18&#39;, &#39;id_19&#39;, &#39;id_20&#39;, &#39;id_21&#39;, &#39;id_22&#39;, &#39;id_24&#39;, &#39;id_25&#39;,
       &#39;id_26&#39;, &#39;id_32&#39;],
      dtype=&#39;object&#39;, length=399)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ahora observamos las columnas con datos tipo int</span>
<span class="n">train_data_transactions</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;TransactionID&#39;, &#39;isFraud&#39;, &#39;TransactionDT&#39;, &#39;card1&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Finalmente vemos las columnas con datos tipo object</span>
<span class="n">train_data_transactions</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;ProductCD&#39;, &#39;card4&#39;, &#39;card6&#39;, &#39;P_emaildomain&#39;, &#39;R_emaildomain&#39;, &#39;M1&#39;,
       &#39;M2&#39;, &#39;M3&#39;, &#39;M4&#39;, &#39;M5&#39;, &#39;M6&#39;, &#39;M7&#39;, &#39;M8&#39;, &#39;M9&#39;, &#39;id_12&#39;, &#39;id_15&#39;,
       &#39;id_16&#39;, &#39;id_23&#39;, &#39;id_27&#39;, &#39;id_28&#39;, &#39;id_29&#39;, &#39;id_30&#39;, &#39;id_31&#39;, &#39;id_33&#39;,
       &#39;id_34&#39;, &#39;id_35&#39;, &#39;id_36&#39;, &#39;id_37&#39;, &#39;id_38&#39;, &#39;DeviceType&#39;,
       &#39;DeviceInfo&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a revisar la media, desviacion estandar, minimo, maximo y cuartiles de las columnas con valores numericos</span>
<span class="n">train_data_transactions</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TransactionID</th>
      <th>isFraud</th>
      <th>TransactionDT</th>
      <th>TransactionAmt</th>
      <th>card1</th>
      <th>card2</th>
      <th>card3</th>
      <th>card5</th>
      <th>addr1</th>
      <th>addr2</th>
      <th>...</th>
      <th>id_17</th>
      <th>id_18</th>
      <th>id_19</th>
      <th>id_20</th>
      <th>id_21</th>
      <th>id_22</th>
      <th>id_24</th>
      <th>id_25</th>
      <th>id_26</th>
      <th>id_32</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>5.905400e+05</td>
      <td>590540.000000</td>
      <td>5.905400e+05</td>
      <td>590540.000000</td>
      <td>590540.000000</td>
      <td>581607.000000</td>
      <td>588975.000000</td>
      <td>586281.000000</td>
      <td>524834.000000</td>
      <td>524834.000000</td>
      <td>...</td>
      <td>139369.000000</td>
      <td>45113.000000</td>
      <td>139318.000000</td>
      <td>139261.000000</td>
      <td>5159.000000</td>
      <td>5169.000000</td>
      <td>4747.000000</td>
      <td>5132.000000</td>
      <td>5163.000000</td>
      <td>77586.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3.282270e+06</td>
      <td>0.034990</td>
      <td>7.372311e+06</td>
      <td>135.027176</td>
      <td>9898.734658</td>
      <td>362.555488</td>
      <td>153.194925</td>
      <td>199.278897</td>
      <td>290.733794</td>
      <td>86.800630</td>
      <td>...</td>
      <td>189.451377</td>
      <td>14.237337</td>
      <td>353.128174</td>
      <td>403.882666</td>
      <td>368.269820</td>
      <td>16.002708</td>
      <td>12.800927</td>
      <td>329.608924</td>
      <td>149.070308</td>
      <td>26.508597</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.704744e+05</td>
      <td>0.183755</td>
      <td>4.617224e+06</td>
      <td>239.162522</td>
      <td>4901.170153</td>
      <td>157.793246</td>
      <td>11.336444</td>
      <td>41.244453</td>
      <td>101.741072</td>
      <td>2.690623</td>
      <td>...</td>
      <td>30.375360</td>
      <td>1.561302</td>
      <td>141.095343</td>
      <td>152.160327</td>
      <td>198.847038</td>
      <td>6.897665</td>
      <td>2.372447</td>
      <td>97.461089</td>
      <td>32.101995</td>
      <td>3.737502</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.987000e+06</td>
      <td>0.000000</td>
      <td>8.640000e+04</td>
      <td>0.251000</td>
      <td>1000.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>10.000000</td>
      <td>...</td>
      <td>100.000000</td>
      <td>10.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>10.000000</td>
      <td>11.000000</td>
      <td>100.000000</td>
      <td>100.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.134635e+06</td>
      <td>0.000000</td>
      <td>3.027058e+06</td>
      <td>43.321000</td>
      <td>6019.000000</td>
      <td>214.000000</td>
      <td>150.000000</td>
      <td>166.000000</td>
      <td>204.000000</td>
      <td>87.000000</td>
      <td>...</td>
      <td>166.000000</td>
      <td>13.000000</td>
      <td>266.000000</td>
      <td>256.000000</td>
      <td>252.000000</td>
      <td>14.000000</td>
      <td>11.000000</td>
      <td>321.000000</td>
      <td>119.000000</td>
      <td>24.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>3.282270e+06</td>
      <td>0.000000</td>
      <td>7.306528e+06</td>
      <td>68.769000</td>
      <td>9678.000000</td>
      <td>361.000000</td>
      <td>150.000000</td>
      <td>226.000000</td>
      <td>299.000000</td>
      <td>87.000000</td>
      <td>...</td>
      <td>166.000000</td>
      <td>15.000000</td>
      <td>341.000000</td>
      <td>472.000000</td>
      <td>252.000000</td>
      <td>14.000000</td>
      <td>11.000000</td>
      <td>321.000000</td>
      <td>149.000000</td>
      <td>24.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.429904e+06</td>
      <td>0.000000</td>
      <td>1.124662e+07</td>
      <td>125.000000</td>
      <td>14184.000000</td>
      <td>512.000000</td>
      <td>150.000000</td>
      <td>226.000000</td>
      <td>330.000000</td>
      <td>87.000000</td>
      <td>...</td>
      <td>225.000000</td>
      <td>15.000000</td>
      <td>427.000000</td>
      <td>533.000000</td>
      <td>486.500000</td>
      <td>14.000000</td>
      <td>15.000000</td>
      <td>371.000000</td>
      <td>169.000000</td>
      <td>32.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3.577539e+06</td>
      <td>1.000000</td>
      <td>1.581113e+07</td>
      <td>31937.391000</td>
      <td>18396.000000</td>
      <td>600.000000</td>
      <td>231.000000</td>
      <td>237.000000</td>
      <td>540.000000</td>
      <td>102.000000</td>
      <td>...</td>
      <td>229.000000</td>
      <td>29.000000</td>
      <td>671.000000</td>
      <td>661.000000</td>
      <td>854.000000</td>
      <td>44.000000</td>
      <td>26.000000</td>
      <td>548.000000</td>
      <td>216.000000</td>
      <td>32.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 403 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a hacer un conteo de NAs por columna</span>
<span class="n">train_data_transactions</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1">#Vamos a ver el porcentaje de NAs por columna</span>
<span class="n">train_data_transactions</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">train_data_transactions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#Ahora creamos un dataframe con el nombre de las columnas y su porcentaje de NAs para las 25 columnas con menos NAs</span>
<span class="n">NAs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_data_transactions</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="n">train_data_transactions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">NAs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;column_name&#39;</span><span class="p">,</span> <span class="s1">&#39;nas_percentage&#39;</span><span class="p">]</span>
<span class="n">NAs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;nas_percentage&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>column_name</th>
      <th>nas_percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TransactionID</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>30</th>
      <td>C14</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>29</th>
      <td>C13</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>28</th>
      <td>C12</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>27</th>
      <td>C11</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>26</th>
      <td>C10</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>24</th>
      <td>C8</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>23</th>
      <td>C7</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>22</th>
      <td>C6</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>21</th>
      <td>C5</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>20</th>
      <td>C4</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>C3</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>18</th>
      <td>C2</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>17</th>
      <td>C1</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>C9</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>isFraud</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>TransactionDT</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TransactionAmt</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ProductCD</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>card1</td>
      <td>0.00000</td>
    </tr>
    <tr>
      <th>344</th>
      <td>V290</td>
      <td>0.00002</td>
    </tr>
    <tr>
      <th>360</th>
      <td>V306</td>
      <td>0.00002</td>
    </tr>
    <tr>
      <th>361</th>
      <td>V307</td>
      <td>0.00002</td>
    </tr>
    <tr>
      <th>362</th>
      <td>V308</td>
      <td>0.00002</td>
    </tr>
    <tr>
      <th>363</th>
      <td>V309</td>
      <td>0.00002</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a ver un grafico de barras con el porcentaje de NAs por columna</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">NAs</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;column_name&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;nas_percentage&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Como podemos observar hay columnas que mayoria de sus datos son NAs pero tambien hay muchas en las que se tienen pocos o ninguno, estas son las que seleccionaran para observar con mas detalle en el EDA ya que se sospecha que son las que mejor nos ayudan a detectar fraudes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#La variable respuesta es isFraud, es una variable binaria, vamos a ver la cantidad de 0 y 1 a ver si esta balanceada</span>
<span class="n">train_data_transactions</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="c1">#Lo vemos en un histograma</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">train_data_transactions</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;isFraud&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>La gran mayoria de nuestras muestras son casos que no son fraudes, es posible que un modelo generado a partir de este training set solo sea capaz de detectar casos no fraudes y se le sea dificil detectar fraudes. Ahora observaremos la distribucion en el testing data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_data_transactions</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TransactionID</th>
      <th>TransactionDT</th>
      <th>TransactionAmt</th>
      <th>ProductCD</th>
      <th>card1</th>
      <th>card2</th>
      <th>card3</th>
      <th>card4</th>
      <th>card5</th>
      <th>card6</th>
      <th>...</th>
      <th>id-31</th>
      <th>id-32</th>
      <th>id-33</th>
      <th>id-34</th>
      <th>id-35</th>
      <th>id-36</th>
      <th>id-37</th>
      <th>id-38</th>
      <th>DeviceType</th>
      <th>DeviceInfo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3663549</td>
      <td>18403224</td>
      <td>31.95</td>
      <td>W</td>
      <td>10409</td>
      <td>111.0</td>
      <td>150.0</td>
      <td>visa</td>
      <td>226.0</td>
      <td>debit</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3663550</td>
      <td>18403263</td>
      <td>49.00</td>
      <td>W</td>
      <td>4272</td>
      <td>111.0</td>
      <td>150.0</td>
      <td>visa</td>
      <td>226.0</td>
      <td>debit</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3663551</td>
      <td>18403310</td>
      <td>171.00</td>
      <td>W</td>
      <td>4476</td>
      <td>574.0</td>
      <td>150.0</td>
      <td>visa</td>
      <td>226.0</td>
      <td>debit</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3663552</td>
      <td>18403310</td>
      <td>284.95</td>
      <td>W</td>
      <td>10989</td>
      <td>360.0</td>
      <td>150.0</td>
      <td>visa</td>
      <td>166.0</td>
      <td>debit</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3663553</td>
      <td>18403317</td>
      <td>67.95</td>
      <td>W</td>
      <td>18018</td>
      <td>452.0</td>
      <td>150.0</td>
      <td>mastercard</td>
      <td>117.0</td>
      <td>debit</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 433 columns</p>
</div></div></div>
</div>
<p>La data de testing no tiene variable respuesta asi que es necesario generar un testing set a partir de la data de entrenamiento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a generar un set de test con el 20% de los datos de train_transactions_data</span>
<span class="c1">#La idea es que el set de test tenga la misma proporcion de 0 y 1 que el set de train</span>
<span class="n">train_data_transactions</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="c1">#Vemos que hay 20663 observaciones con 1 y 569877 observaciones con 0</span>
<span class="c1">#Vamos a generar un set de test con 4133 observaciones con 1 y 113975 observaciones con 0</span>
<span class="c1">#Para eso vamos a hacer un split con la opcion stratify</span>
<span class="n">train_data_transactions</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#Vemos que el 3.5% de las observaciones tienen 1 y el 96.5% tienen 0</span>
<span class="c1">#Vamos a hacer el split con la opcion stratify</span>
<span class="n">tr_train</span><span class="p">,</span> <span class="n">tr_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_data_transactions</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">train_data_transactions</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a observar la proporcion de 0 y 1 en el set de train y test en un dataframe</span>
<span class="n">tr_train</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tr_test</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tr_train</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">tr_test</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    0.965011
1    0.034989
Name: isFraud, dtype: float64 0    0.965007
1    0.034993
Name: isFraud, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Vemos que ahora si nuestros datasets tienen informacion de ambos tipos de respuesta. Se podrian generar datos sinteticos con tecnimas como Oversampling para balancear los datos y tener una cantidad similar para ambas respuestas sin embargo lo vamos a omitir por ahora ya que solo estamos analizando los datos y no generando modelos todavia. Es posible que al momento de generar el modelo, por cuestiones de tiempo no se contemple esta opcion pero en un contexto sin restricciones de tiempo vale la pena comparar resultados.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos analizar con mas detalle las variables TransactionAmt, ProductCD, TransactionDT, card1</span>
<span class="c1">#Realizemos un analisis de simetria, datos atipicos, y dispersion para cada una</span>
<span class="c1">#Primero vamos a ver la distribucion de TransactionAmt</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">tr_train</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;TransactionAmt&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Se puede evidenciar que tiene un sesgo a la derecha y es posible suponer que hay datos atipicos y la dispersion es alta.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Repetimos para ProductCD</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">tr_train</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;ProductCD&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Esta variable es categorica, con 5 diferentes respuestas, la gran mayoria es de tipo W. Ahora veamos como se relaciona cada tipo con la variable respuesta.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Veamos como se relaciona ProductCD con isFraud</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">tr_train</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;ProductCD&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;isFraud&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>En todas las opciones hay casos fraude asi que se mantienen en el estudio. Es posible tambien que la variable no un aporte significativo a la decision.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Repetimos para TransactionDT</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">tr_train</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;TransactionDT&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Vemos que tiene una distribucion relativamente asimetrica y su rango de valores es enorme, es posible que dificilmente logre explicar la variable respuesta a partir de sus datos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Finalmente para card1</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">tr_train</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;card1&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Podemos observar que su rango es muy amplio tambien, distribucion asimetrica y con posiblemente datos atipicos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a eliminar las columnas con mas del 70% de NAs</span>
<span class="n">train_data_transactions_2</span> <span class="o">=</span> <span class="n">train_data_transactions</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">train_data_transactions</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">.7</span><span class="p">]</span>
<span class="n">train_data_transactions_2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(590540, 226)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#De nuevo ahora usamos nuestro nuevo set para train y test</span>
<span class="n">train_data_transactions_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">train_data_transactions_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tr_train_2</span><span class="p">,</span> <span class="n">tr_test_2</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_data_transactions_2</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">train_data_transactions_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a realizar imputacion de faltantes con la mediana en las columnas de tr_train_2</span>
<span class="c1">#Usemos impute() de sklearn para imputar los faltantes</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="c1">#Vamos a filtrar las columnas numericas del set</span>
<span class="n">tr_train_2_num</span> <span class="o">=</span> <span class="n">tr_train_2</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="c1">#Ahora vamos a imputar los faltantes</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tr_train_2_num</span><span class="p">)</span>
<span class="n">tr_train_2_num_imp</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tr_train_2_num</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora usamos los valores de tr_train_2_num_imp para reemplazar las columnas numericas de tr_train_2</span>
<span class="n">tr_train_2_num_imp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tr_train_2_num_imp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">tr_train_2_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="c1">#Ahora tr_train_2 le agregamos las columnas numericas imputadas</span>
<span class="n">tr_train_2</span> <span class="o">=</span> <span class="n">tr_train_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tr_train_2_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">tr_train_2</span> <span class="o">=</span> <span class="n">tr_train_2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tr_train_2_num_imp_df</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Repetimos el proceso para testing</span>
<span class="n">tr_test_2_num</span> <span class="o">=</span> <span class="n">tr_test_2</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tr_test_2_num</span><span class="p">)</span>
<span class="n">tr_test_2_num_imp</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tr_test_2_num</span><span class="p">)</span>
<span class="n">tr_test_2_num_imp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tr_test_2_num_imp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">tr_test_2_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">tr_test_2</span> <span class="o">=</span> <span class="n">tr_test_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tr_test_2_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">tr_test_2</span> <span class="o">=</span> <span class="n">tr_test_2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tr_test_2_num_imp_df</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora hacemos un analisis de correlacion entre las variables de tr_train_2 </span>
<span class="c1">#Primero vamos a filtrar las columnas numericas y sin incluir isFraud</span>
<span class="n">tr_train_2_num_corr</span> <span class="o">=</span> <span class="n">tr_train_2_num</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">])</span>
<span class="c1">#Ahora vamos a ver la correlacion entre las variables</span>
<span class="n">tr_train_2_num_corr</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TransactionID</th>
      <th>TransactionDT</th>
      <th>TransactionAmt</th>
      <th>card1</th>
      <th>card2</th>
      <th>card3</th>
      <th>card5</th>
      <th>addr1</th>
      <th>addr2</th>
      <th>dist1</th>
      <th>...</th>
      <th>V312</th>
      <th>V313</th>
      <th>V314</th>
      <th>V315</th>
      <th>V316</th>
      <th>V317</th>
      <th>V318</th>
      <th>V319</th>
      <th>V320</th>
      <th>V321</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>TransactionID</th>
      <td>1.000000</td>
      <td>0.998280</td>
      <td>0.012247</td>
      <td>0.009052</td>
      <td>-0.019369</td>
      <td>-0.010626</td>
      <td>-0.023389</td>
      <td>-0.000902</td>
      <td>0.056286</td>
      <td>-0.028635</td>
      <td>...</td>
      <td>0.038697</td>
      <td>0.029072</td>
      <td>0.042493</td>
      <td>0.028880</td>
      <td>0.057764</td>
      <td>0.056432</td>
      <td>0.062696</td>
      <td>0.017587</td>
      <td>0.052934</td>
      <td>0.039374</td>
    </tr>
    <tr>
      <th>TransactionDT</th>
      <td>0.998280</td>
      <td>1.000000</td>
      <td>0.012163</td>
      <td>0.009557</td>
      <td>-0.018673</td>
      <td>-0.011793</td>
      <td>-0.023637</td>
      <td>-0.000576</td>
      <td>0.051086</td>
      <td>-0.028938</td>
      <td>...</td>
      <td>0.038928</td>
      <td>0.028642</td>
      <td>0.042564</td>
      <td>0.028242</td>
      <td>0.060126</td>
      <td>0.058749</td>
      <td>0.065319</td>
      <td>0.018302</td>
      <td>0.054955</td>
      <td>0.040879</td>
    </tr>
    <tr>
      <th>TransactionAmt</th>
      <td>0.012247</td>
      <td>0.012163</td>
      <td>1.000000</td>
      <td>-0.005959</td>
      <td>0.015969</td>
      <td>-0.109148</td>
      <td>0.001496</td>
      <td>-0.008658</td>
      <td>0.027737</td>
      <td>0.024938</td>
      <td>...</td>
      <td>0.103422</td>
      <td>0.188066</td>
      <td>0.145969</td>
      <td>0.174331</td>
      <td>0.013932</td>
      <td>0.010876</td>
      <td>0.013933</td>
      <td>0.127611</td>
      <td>0.102201</td>
      <td>0.119556</td>
    </tr>
    <tr>
      <th>card1</th>
      <td>0.009052</td>
      <td>0.009557</td>
      <td>-0.005959</td>
      <td>1.000000</td>
      <td>0.003456</td>
      <td>0.004068</td>
      <td>-0.092662</td>
      <td>0.020058</td>
      <td>-0.000179</td>
      <td>0.004999</td>
      <td>...</td>
      <td>0.005822</td>
      <td>0.002300</td>
      <td>0.012435</td>
      <td>0.000875</td>
      <td>0.045871</td>
      <td>0.050707</td>
      <td>0.051874</td>
      <td>0.009020</td>
      <td>0.036245</td>
      <td>0.025729</td>
    </tr>
    <tr>
      <th>card2</th>
      <td>-0.019369</td>
      <td>-0.018673</td>
      <td>0.015969</td>
      <td>0.003456</td>
      <td>1.000000</td>
      <td>0.025094</td>
      <td>0.030027</td>
      <td>0.030028</td>
      <td>-0.022354</td>
      <td>-0.014372</td>
      <td>...</td>
      <td>0.001238</td>
      <td>-0.000363</td>
      <td>0.004628</td>
      <td>0.001120</td>
      <td>0.029266</td>
      <td>0.031910</td>
      <td>0.032666</td>
      <td>0.015716</td>
      <td>0.030406</td>
      <td>0.025467</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>V317</th>
      <td>0.056432</td>
      <td>0.058749</td>
      <td>0.010876</td>
      <td>0.050707</td>
      <td>0.031910</td>
      <td>-0.016395</td>
      <td>-0.093664</td>
      <td>0.014347</td>
      <td>-0.003121</td>
      <td>0.019272</td>
      <td>...</td>
      <td>0.222431</td>
      <td>0.048310</td>
      <td>0.186796</td>
      <td>0.046652</td>
      <td>0.909175</td>
      <td>1.000000</td>
      <td>0.968438</td>
      <td>0.132213</td>
      <td>0.590630</td>
      <td>0.378573</td>
    </tr>
    <tr>
      <th>V318</th>
      <td>0.062696</td>
      <td>0.065319</td>
      <td>0.013933</td>
      <td>0.051874</td>
      <td>0.032666</td>
      <td>-0.014966</td>
      <td>-0.098958</td>
      <td>0.015853</td>
      <td>0.001599</td>
      <td>0.014299</td>
      <td>...</td>
      <td>0.231721</td>
      <td>0.054354</td>
      <td>0.195217</td>
      <td>0.050700</td>
      <td>0.939396</td>
      <td>0.968438</td>
      <td>1.000000</td>
      <td>0.144186</td>
      <td>0.617874</td>
      <td>0.408474</td>
    </tr>
    <tr>
      <th>V319</th>
      <td>0.017587</td>
      <td>0.018302</td>
      <td>0.127611</td>
      <td>0.009020</td>
      <td>0.015716</td>
      <td>-0.014116</td>
      <td>-0.018457</td>
      <td>0.004619</td>
      <td>0.003748</td>
      <td>0.006956</td>
      <td>...</td>
      <td>0.052643</td>
      <td>0.036706</td>
      <td>0.048612</td>
      <td>0.030407</td>
      <td>0.135677</td>
      <td>0.132213</td>
      <td>0.144186</td>
      <td>1.000000</td>
      <td>0.788243</td>
      <td>0.920414</td>
    </tr>
    <tr>
      <th>V320</th>
      <td>0.052934</td>
      <td>0.054955</td>
      <td>0.102201</td>
      <td>0.036245</td>
      <td>0.030406</td>
      <td>-0.023520</td>
      <td>-0.066935</td>
      <td>0.010030</td>
      <td>0.004369</td>
      <td>0.013284</td>
      <td>...</td>
      <td>0.195654</td>
      <td>0.065002</td>
      <td>0.163226</td>
      <td>0.062674</td>
      <td>0.550614</td>
      <td>0.590630</td>
      <td>0.617874</td>
      <td>0.788243</td>
      <td>1.000000</td>
      <td>0.938065</td>
    </tr>
    <tr>
      <th>V321</th>
      <td>0.039374</td>
      <td>0.040879</td>
      <td>0.119556</td>
      <td>0.025729</td>
      <td>0.025467</td>
      <td>-0.019310</td>
      <td>-0.050230</td>
      <td>0.008866</td>
      <td>0.004787</td>
      <td>0.011604</td>
      <td>...</td>
      <td>0.140904</td>
      <td>0.055400</td>
      <td>0.116507</td>
      <td>0.051259</td>
      <td>0.363770</td>
      <td>0.378573</td>
      <td>0.408474</td>
      <td>0.920414</td>
      <td>0.938065</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>212 rows × 212 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matriz_correlacion</span> <span class="o">=</span> <span class="n">tr_train_2_num_corr</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Quiero contar la cantidad de nan o infs en matriz_correlacion</span>
<span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">matriz_correlacion</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1">#Remplazar los nan con 0 en matriz_correlacion para poder usar VIF</span>
<span class="n">matriz_correlacion</span> <span class="o">=</span> <span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a realizar el calculo de VIF para cada variable</span>
<span class="c1">#Primero vamos a crear un dataframe con las variables y su VIF</span>
<span class="n">vif</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">columns</span>
<span class="c1">#Ahora calculamos el VIF para cada variable</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="c1">#Ahora revisamos si la mas alta es mayor a 5</span>
<span class="n">vif</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;VIF&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>variables</th>
      <th>VIF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>165</th>
      <td>V134</td>
      <td>6.042497e+09</td>
    </tr>
    <tr>
      <th>208</th>
      <td>V318</td>
      <td>3.898242e+09</td>
    </tr>
    <tr>
      <th>163</th>
      <td>V132</td>
      <td>3.861261e+09</td>
    </tr>
    <tr>
      <th>206</th>
      <td>V316</td>
      <td>2.975545e+09</td>
    </tr>
    <tr>
      <th>196</th>
      <td>V306</td>
      <td>2.564640e+09</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a contar cuantas variables tienen VIF mayor a 5</span>
<span class="n">vif</span><span class="p">[</span><span class="n">vif</span><span class="p">[</span><span class="s1">&#39;VIF&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>211
</pre></div>
</div>
</div>
</div>
<p>Al observar que el VIF es tan grande en todas las variables, se puede asumir que debido a la gran cantidad de variables y sus valores de correlacion, es mejor manualmente revisar las correlaciones y hacer una filtracion mas manual con fines de continuar el estudio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a mirar el par de columnas con correlacion arriba de 0.95</span>
<span class="c1">#Vamos a crear una lista con las columnas que tienen correlacion arriba de 0.95</span>
<span class="n">columnas_correlacion</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">columnas_primera</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.95</span><span class="p">:</span>
            <span class="n">columna1</span> <span class="o">=</span> <span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">columna2</span> <span class="o">=</span> <span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">columna</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">columna1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">columna2</span><span class="p">)</span>
            <span class="n">columnas_correlacion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">columna</span><span class="p">)</span>
            <span class="n">columnas_primera</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">columna1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a ver el tamaño de la lista</span>
<span class="nb">len</span><span class="p">(</span><span class="n">columnas_correlacion</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>184
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Hay 183 pares, vamos a revisar las variables mas repetidas en los pares</span>
<span class="c1">#Vamos a contar las repeticiones de cada valor unico en columnas_primera</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="n">Counter</span><span class="p">(</span><span class="n">columnas_primera</span><span class="p">)</span>
<span class="c1">#Ordenamos de mayor a menor</span>
<span class="n">Counter</span><span class="p">(</span><span class="n">columnas_primera</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;V318&#39;, 13),
 (&#39;V308&#39;, 11),
 (&#39;V295&#39;, 9),
 (&#39;V280&#39;, 8),
 (&#39;V134&#39;, 7),
 (&#39;V316&#39;, 7),
 (&#39;C11&#39;, 6),
 (&#39;V133&#39;, 6),
 (&#39;V306&#39;, 6),
 (&#39;V317&#39;, 6),
 (&#39;C10&#39;, 5),
 (&#39;V128&#39;, 5),
 (&#39;V293&#39;, 5),
 (&#39;V307&#39;, 5),
 (&#39;C8&#39;, 4),
 (&#39;V127&#39;, 4),
 (&#39;V279&#39;, 4),
 (&#39;C6&#39;, 3),
 (&#39;C12&#39;, 3),
 (&#39;C14&#39;, 3),
 (&#39;V84&#39;, 3),
 (&#39;V92&#39;, 3),
 (&#39;V94&#39;, 3),
 (&#39;V103&#39;, 3),
 (&#39;V132&#39;, 3),
 (&#39;V299&#39;, 3),
 (&#39;C4&#39;, 2),
 (&#39;V50&#39;, 2),
 (&#39;V71&#39;, 2),
 (&#39;V102&#39;, 2),
 (&#39;V126&#39;, 2),
 (&#39;V298&#39;, 2),
 (&#39;TransactionDT&#39;, 1),
 (&#39;C2&#39;, 1),
 (&#39;D2&#39;, 1),
 (&#39;V11&#39;, 1),
 (&#39;V16&#39;, 1),
 (&#39;V18&#39;, 1),
 (&#39;V21&#39;, 1),
 (&#39;V22&#39;, 1),
 (&#39;V28&#39;, 1),
 (&#39;V30&#39;, 1),
 (&#39;V32&#39;, 1),
 (&#39;V33&#39;, 1),
 (&#39;V34&#39;, 1),
 (&#39;V43&#39;, 1),
 (&#39;V49&#39;, 1),
 (&#39;V52&#39;, 1),
 (&#39;V57&#39;, 1),
 (&#39;V58&#39;, 1),
 (&#39;V60&#39;, 1),
 (&#39;V63&#39;, 1),
 (&#39;V70&#39;, 1),
 (&#39;V72&#39;, 1),
 (&#39;V74&#39;, 1),
 (&#39;V81&#39;, 1),
 (&#39;V88&#39;, 1),
 (&#39;V89&#39;, 1),
 (&#39;V91&#39;, 1),
 (&#39;V93&#39;, 1),
 (&#39;V97&#39;, 1),
 (&#39;V101&#39;, 1),
 (&#39;V106&#39;, 1),
 (&#39;V292&#39;, 1),
 (&#39;V296&#39;, 1),
 (&#39;V304&#39;, 1)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a crear una lista con las columnas que vamos a eliminar, todas las que tengan mas de 3 repeticiones</span>
<span class="n">columnas_eliminar</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">columnas_primera</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">())):</span>
    <span class="k">if</span> <span class="n">Counter</span><span class="p">(</span><span class="n">columnas_primera</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">columnas_eliminar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">columnas_primera</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">()[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columnas_eliminar</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;V318&#39;,
 &#39;V308&#39;,
 &#39;V295&#39;,
 &#39;V280&#39;,
 &#39;V134&#39;,
 &#39;V316&#39;,
 &#39;C11&#39;,
 &#39;V133&#39;,
 &#39;V306&#39;,
 &#39;V317&#39;,
 &#39;C10&#39;,
 &#39;V128&#39;,
 &#39;V293&#39;,
 &#39;V307&#39;,
 &#39;C8&#39;,
 &#39;V127&#39;,
 &#39;V279&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a agregar las columnas que no sean numericas a la lista de columnas a eliminar</span>
<span class="c1">#Miremos que columnas no tienen type float o int</span>
<span class="n">no_numericas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tr_train_2</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">no_numericas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ProductCD&#39;,
 &#39;card4&#39;,
 &#39;card6&#39;,
 &#39;P_emaildomain&#39;,
 &#39;M1&#39;,
 &#39;M2&#39;,
 &#39;M3&#39;,
 &#39;M4&#39;,
 &#39;M5&#39;,
 &#39;M6&#39;,
 &#39;M7&#39;,
 &#39;M8&#39;,
 &#39;M9&#39;]
</pre></div>
</div>
</div>
</div>
<p>Esta decision se tomo debido a un error durante el proceso del Pipeline, usando OneHotEncoding para estas variables. No era posible realizarlo implementado en un GridSearch y por motivos del examen se decidio continuar de esta manera y analizar los resultados obtenidos asi. Dado el caso que no sean buenos se visita retomarlos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Agregamos no_numericas a columnas_eliminar</span>
<span class="n">columnas_eliminar</span> <span class="o">=</span> <span class="n">columnas_eliminar</span> <span class="o">+</span> <span class="n">no_numericas</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Eliminamos las columnas de tr_train_2 y tr_test_2</span>
<span class="n">tr_train_2</span> <span class="o">=</span> <span class="n">tr_train_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columnas_eliminar</span><span class="p">)</span>
<span class="n">tr_test_2</span> <span class="o">=</span> <span class="n">tr_test_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columnas_eliminar</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tr_train_2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(378060, 196)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tr_test_2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(23668, 196)
</pre></div>
</div>
</div>
</div>
<p>Con estos datos vamos a generar nuestros modelos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tr_train_2</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TransactionID</th>
      <th>isFraud</th>
      <th>TransactionDT</th>
      <th>TransactionAmt</th>
      <th>card1</th>
      <th>card2</th>
      <th>card3</th>
      <th>card5</th>
      <th>addr1</th>
      <th>addr2</th>
      <th>...</th>
      <th>V309</th>
      <th>V310</th>
      <th>V311</th>
      <th>V312</th>
      <th>V313</th>
      <th>V314</th>
      <th>V315</th>
      <th>V319</th>
      <th>V320</th>
      <th>V321</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>40809</th>
      <td>3115448.0</td>
      <td>0.0</td>
      <td>2562600.0</td>
      <td>107.95</td>
      <td>6530.0</td>
      <td>206.0</td>
      <td>150.0</td>
      <td>166.0</td>
      <td>485.0</td>
      <td>87.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>500.799988</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>285886</th>
      <td>3298993.0</td>
      <td>0.0</td>
      <td>7766224.0</td>
      <td>554.00</td>
      <td>6394.0</td>
      <td>225.0</td>
      <td>150.0</td>
      <td>224.0</td>
      <td>203.0</td>
      <td>87.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>104256</th>
      <td>3055194.0</td>
      <td>0.0</td>
      <td>1542937.0</td>
      <td>20.00</td>
      <td>11275.0</td>
      <td>420.0</td>
      <td>150.0</td>
      <td>195.0</td>
      <td>315.0</td>
      <td>87.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>65.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>50.0</td>
      <td>65.000000</td>
      <td>65.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>196382</th>
      <td>3311349.0</td>
      <td>0.0</td>
      <td>8020102.0</td>
      <td>19.50</td>
      <td>7919.0</td>
      <td>194.0</td>
      <td>150.0</td>
      <td>166.0</td>
      <td>272.0</td>
      <td>87.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>175534</th>
      <td>3541183.0</td>
      <td>0.0</td>
      <td>14657461.0</td>
      <td>47.95</td>
      <td>6550.0</td>
      <td>361.0</td>
      <td>150.0</td>
      <td>226.0</td>
      <td>184.0</td>
      <td>87.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>73.900002</td>
      <td>0.0</td>
      <td>25.950001</td>
      <td>0.0</td>
      <td>73.900002</td>
      <td>47.950001</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 196 columns</p>
</div></div></div>
</div>
</section>
<section id="wind-speed">
<h2>Wind Speed<a class="headerlink" href="#wind-speed" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a leer los datos para wind speed</span>
<span class="n">train_wind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_treino_dv_df_2000_2010.csv&quot;</span><span class="p">)</span>
<span class="n">test_wind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data_teste_dv_df_2011.csv&quot;</span><span class="p">)</span>

<span class="c1">#Vemos las primeras 5 filas de train_wind</span>
<span class="n">train_wind</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>HORA (UTC)</th>
      <th>VENTO, DIREï¿½ï¿½O HORARIA (gr) (ï¿½ (gr))</th>
      <th>VENTO, VELOCIDADE HORARIA (m/s)</th>
      <th>UMIDADE REL. MAX. NA HORA ANT. (AUT) (%)</th>
      <th>UMIDADE REL. MIN. NA HORA ANT. (AUT) (%)</th>
      <th>TEMPERATURA Mï¿½XIMA NA HORA ANT. (AUT) (ï¿½C)</th>
      <th>TEMPERATURA Mï¿½NIMA NA HORA ANT. (AUT) (ï¿½C)</th>
      <th>UMIDADE RELATIVA DO AR, HORARIA (%)</th>
      <th>PRESSAO ATMOSFERICA AO NIVEL DA ESTACAO, HORARIA (mB)</th>
      <th>PRECIPITAï¿½ï¿½O TOTAL, HORï¿½RIO (mm)</th>
      <th>VENTO, RAJADA MAXIMA (m/s)</th>
      <th>PRESSï¿½O ATMOSFERICA MAX.NA HORA ANT. (AUT) (mB)</th>
      <th>PRESSï¿½O ATMOSFERICA MIN. NA HORA ANT. (AUT) (mB)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12:00</td>
      <td>0.809017</td>
      <td>1.8</td>
      <td>69.0</td>
      <td>60.0</td>
      <td>22.6</td>
      <td>20.7</td>
      <td>61.0</td>
      <td>888.2</td>
      <td>0.0</td>
      <td>3.8</td>
      <td>888.2</td>
      <td>887.7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13:00</td>
      <td>0.965926</td>
      <td>2.7</td>
      <td>62.0</td>
      <td>55.0</td>
      <td>24.2</td>
      <td>22.5</td>
      <td>55.0</td>
      <td>888.4</td>
      <td>0.0</td>
      <td>4.7</td>
      <td>888.4</td>
      <td>888.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14:00</td>
      <td>0.891007</td>
      <td>2.0</td>
      <td>56.0</td>
      <td>50.0</td>
      <td>25.5</td>
      <td>24.3</td>
      <td>51.0</td>
      <td>888.1</td>
      <td>0.0</td>
      <td>4.9</td>
      <td>888.4</td>
      <td>888.1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15:00</td>
      <td>0.848048</td>
      <td>2.5</td>
      <td>52.0</td>
      <td>44.0</td>
      <td>27.4</td>
      <td>25.0</td>
      <td>44.0</td>
      <td>887.4</td>
      <td>0.0</td>
      <td>5.8</td>
      <td>888.1</td>
      <td>887.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16:00</td>
      <td>0.224951</td>
      <td>2.4</td>
      <td>50.0</td>
      <td>43.0</td>
      <td>27.1</td>
      <td>25.5</td>
      <td>46.0</td>
      <td>886.5</td>
      <td>0.0</td>
      <td>5.8</td>
      <td>887.4</td>
      <td>886.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vemos la cantidad de observaciones que tenemos</span>
<span class="n">train_wind</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(87693, 13)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a cambiar el nombre de las columnas para que sean mas faciles de usar</span>
<span class="c1">#Hora se queda igual, vamos a cambiar las demas</span>
<span class="c1">#La segunda pongamosle Direccion</span>
<span class="c1">#La tercera pongamosle Velocidad</span>
<span class="c1">#La cuarta pongamosle Humedad Min</span>
<span class="c1">#La quinta pongamosle Humedad Max</span>
<span class="c1">#La sexta pongamosle Temperatura Max</span>
<span class="c1">#La septima pongamosle Temperatura Min</span>
<span class="c1">#La octava pongamosle Humedad Relativa</span>
<span class="c1">#La novena pongamosle Presion Atmosferica</span>
<span class="c1">#La decima pongamosle Precipitacion</span>
<span class="c1">#La decima primera pongamosle Rajada Maxima</span>
<span class="c1">#La decima segunda pongamosle Presion Maxima</span>
<span class="c1">#La decima tercera pongamosle Presion Minima</span>
<span class="c1">#Ejecutamos cambios en una copia</span>
<span class="n">train_wind_2</span> <span class="o">=</span> <span class="n">train_wind</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">train_wind_2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">,</span> <span class="s1">&#39;Direccion&#39;</span><span class="p">,</span> <span class="s1">&#39;Velocidad&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad Min&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad Max&#39;</span><span class="p">,</span> <span class="s1">&#39;Temperatura Max&#39;</span><span class="p">,</span> <span class="s1">&#39;Temperatura Min&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad Relativa&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Atmosferica&#39;</span><span class="p">,</span> <span class="s1">&#39;Precipitacion&#39;</span><span class="p">,</span> <span class="s1">&#39;Rajada Maxima&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Maxima&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Minima&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vemos el tipo de datos que tenemos</span>
<span class="n">train_wind_2</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hora                    object
Direccion              float64
Velocidad              float64
Humedad Min            float64
Humedad Max            float64
Temperatura Max        float64
Temperatura Min        float64
Humedad Relativa       float64
Presion Atmosferica    float64
Precipitacion          float64
Rajada Maxima          float64
Presion Maxima         float64
Presion Minima         float64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a revisar la media, desviacion estandar, minimo, maximo y cuartiles</span>
<span class="n">train_wind_2</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Direccion</th>
      <th>Velocidad</th>
      <th>Humedad Min</th>
      <th>Humedad Max</th>
      <th>Temperatura Max</th>
      <th>Temperatura Min</th>
      <th>Humedad Relativa</th>
      <th>Presion Atmosferica</th>
      <th>Precipitacion</th>
      <th>Rajada Maxima</th>
      <th>Presion Maxima</th>
      <th>Presion Minima</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
      <td>87693.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.405810</td>
      <td>2.466192</td>
      <td>69.058465</td>
      <td>63.176194</td>
      <td>21.921264</td>
      <td>20.684570</td>
      <td>66.146682</td>
      <td>887.251925</td>
      <td>0.160907</td>
      <td>5.161076</td>
      <td>887.580724</td>
      <td>886.891093</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.686247</td>
      <td>1.313968</td>
      <td>19.640222</td>
      <td>20.166336</td>
      <td>3.721386</td>
      <td>3.513744</td>
      <td>19.992327</td>
      <td>4.012404</td>
      <td>1.307515</td>
      <td>2.311157</td>
      <td>3.646750</td>
      <td>3.564539</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-1.000000</td>
      <td>0.000000</td>
      <td>12.000000</td>
      <td>10.000000</td>
      <td>9.200000</td>
      <td>8.400000</td>
      <td>10.000000</td>
      <td>863.400000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>865.300000</td>
      <td>862.800000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.156434</td>
      <td>1.500000</td>
      <td>54.000000</td>
      <td>48.000000</td>
      <td>19.200000</td>
      <td>18.400000</td>
      <td>51.000000</td>
      <td>885.300000</td>
      <td>0.000000</td>
      <td>3.400000</td>
      <td>885.600000</td>
      <td>885.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.788011</td>
      <td>2.400000</td>
      <td>72.000000</td>
      <td>64.000000</td>
      <td>21.400000</td>
      <td>20.200000</td>
      <td>68.000000</td>
      <td>887.200000</td>
      <td>0.000000</td>
      <td>5.000000</td>
      <td>887.500000</td>
      <td>886.900000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.970296</td>
      <td>3.400000</td>
      <td>87.000000</td>
      <td>80.000000</td>
      <td>24.700000</td>
      <td>23.100000</td>
      <td>84.000000</td>
      <td>889.100000</td>
      <td>0.000000</td>
      <td>6.800000</td>
      <td>889.300000</td>
      <td>888.800000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>10.000000</td>
      <td>100.000000</td>
      <td>98.000000</td>
      <td>35.300000</td>
      <td>34.400000</td>
      <td>99.000000</td>
      <td>1023.500000</td>
      <td>70.800000</td>
      <td>24.300000</td>
      <td>913.100000</td>
      <td>910.900000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora haremos un conteo de NAs</span>
<span class="n">train_wind_2</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hora                   0
Direccion              0
Velocidad              0
Humedad Min            0
Humedad Max            0
Temperatura Max        0
Temperatura Min        0
Humedad Relativa       0
Presion Atmosferica    0
Precipitacion          0
Rajada Maxima          0
Presion Maxima         0
Presion Minima         0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#La variable respuesta Velocidad, es una variable continua, vamos a ver su distribucion</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">train_wind_2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a hacer el mismo cambio de columnas en test_wind</span>
<span class="n">test_wind_2</span> <span class="o">=</span> <span class="n">test_wind</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">test_wind_2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">,</span> <span class="s1">&#39;Direccion&#39;</span><span class="p">,</span> <span class="s1">&#39;Velocidad&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad Min&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad Max&#39;</span><span class="p">,</span> <span class="s1">&#39;Temperatura Max&#39;</span><span class="p">,</span> <span class="s1">&#39;Temperatura Min&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad Relativa&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Atmosferica&#39;</span><span class="p">,</span> <span class="s1">&#39;Precipitacion&#39;</span><span class="p">,</span> <span class="s1">&#39;Rajada Maxima&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Maxima&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Minima&#39;</span><span class="p">]</span>
<span class="c1">#Ahora vemos la distribucion de la variable respuesta en test_wind_2</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">test_wind_2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">)</span> 
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Podemos ver que es un comportamiento similar, cambia la magnitud de repeticiones por valor debido a la menor cantidad de observaciones. La gran diferencia es la cantidad de observaciones con velocidad 0, en training hay muchos casos. La velocidad del viento nunca debe ser exactamente 0 entonces se van a asumir como Nans.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a contar los 0 en la variable Respuesta en train_wind_2</span>
<span class="c1">#Solo contamos los 0</span>
<span class="n">train_wind_2</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2178
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Eliminamos las observaciones con 0 de Velocidad en train_wind_2</span>
<span class="n">train_wind_2</span> <span class="o">=</span> <span class="n">train_wind_2</span><span class="p">[</span><span class="n">train_wind_2</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1">#Reset el index</span>
<span class="n">train_wind_2</span> <span class="o">=</span> <span class="n">train_wind_2</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a escoger 4 columnas para analizar su comportamiento con la variable respuesta</span>
<span class="c1">#Direccion, Precipitacion, Presion Atmosferica, Humedad Relativa</span>
<span class="c1">#Primero vamos a ver la distribucion de Direccion</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">train_wind_2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Direccion&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Vemos que mayoria de los datos estan en el extremos derecho, es decir que es posible que nuestra prediccion se vea fuertemente afectada por una direccion del viento y no ambas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a ver la distribucion de Precipitacion</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">train_wind_2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Precipitacion&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>La gran mayoria de nuestros datos tienen la misma precipitacion, 0, lo cual nos puede decir que no es algo relevante en este caso para la velocidad del viento.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a ver la distribucion de Presion Atmosferica</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">train_wind_2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Presion Atmosferica&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>En este caso vemos que es muy parecida a una distribucion normal, lo cual nos puede llevar a pensar que su diversidad en valores puede verse reflejada en nuestras predicciones, veamos como se comporta comparando con la variable respuesta.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a ver Presion Atmosferica vs Velocidad</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_wind_2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Presion Atmosferica&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>No es posible evidenciar un patron que relacione ambas variables, vemos que hay muchas velocidades para presiones altas y bajar, los pocos puntos extremos a la derecha podrian ser outliers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora veamos la distribucion de Humedad Relativa</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">train_wind_2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Humedad Relativa&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Vemos que esta sesgada a la izquierda relativamente. No se puede hacer ninguna conclusion unicamente viendo esto, veamos con respecto a la velocidad.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a ver Humedad Relativa vs Velocidad</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_wind_2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Humedad Relativa&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Un balance entre todo tipo de respuesta para todo tipo de valor, tampoco podemos ver un patron o alguna indicacion de relacion entre ellas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora hagamos un analisis de correlacion entre las variables de train_wind_2 sin incluir la variable respuesta</span>
<span class="c1">#Primero vamos a filtrar las columnas numericas y sin incluir Velocidad</span>
<span class="n">train_wind_2_num</span> <span class="o">=</span> <span class="n">train_wind_2</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="n">train_wind_2_num_corr</span> <span class="o">=</span> <span class="n">train_wind_2_num</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="c1">#Ahora vamos a ver la correlacion entre las variables</span>
<span class="n">wind_corr_matrix</span> <span class="o">=</span> <span class="n">train_wind_2_num_corr</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">wind_corr_matrix</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Direccion</th>
      <th>Humedad Min</th>
      <th>Humedad Max</th>
      <th>Temperatura Max</th>
      <th>Temperatura Min</th>
      <th>Humedad Relativa</th>
      <th>Presion Atmosferica</th>
      <th>Precipitacion</th>
      <th>Rajada Maxima</th>
      <th>Presion Maxima</th>
      <th>Presion Minima</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Direccion</th>
      <td>1.000000</td>
      <td>-0.326667</td>
      <td>-0.302374</td>
      <td>-0.012953</td>
      <td>-0.013646</td>
      <td>-0.326705</td>
      <td>0.315755</td>
      <td>-0.079645</td>
      <td>0.146310</td>
      <td>0.340376</td>
      <td>0.352621</td>
    </tr>
    <tr>
      <th>Humedad Min</th>
      <td>-0.326667</td>
      <td>1.000000</td>
      <td>0.976785</td>
      <td>-0.631264</td>
      <td>-0.620211</td>
      <td>0.984132</td>
      <td>-0.198858</td>
      <td>0.153376</td>
      <td>-0.294332</td>
      <td>-0.255968</td>
      <td>-0.247689</td>
    </tr>
    <tr>
      <th>Humedad Max</th>
      <td>-0.302374</td>
      <td>0.976785</td>
      <td>1.000000</td>
      <td>-0.682356</td>
      <td>-0.634072</td>
      <td>0.983185</td>
      <td>-0.195350</td>
      <td>0.121833</td>
      <td>-0.323942</td>
      <td>-0.257320</td>
      <td>-0.240975</td>
    </tr>
    <tr>
      <th>Temperatura Max</th>
      <td>-0.012953</td>
      <td>-0.631264</td>
      <td>-0.682356</td>
      <td>1.000000</td>
      <td>0.974334</td>
      <td>-0.656647</td>
      <td>-0.061698</td>
      <td>-0.040625</td>
      <td>0.360628</td>
      <td>-0.009466</td>
      <td>-0.044401</td>
    </tr>
    <tr>
      <th>Temperatura Min</th>
      <td>-0.013646</td>
      <td>-0.620211</td>
      <td>-0.634072</td>
      <td>0.974334</td>
      <td>1.000000</td>
      <td>-0.627314</td>
      <td>-0.087847</td>
      <td>-0.080528</td>
      <td>0.326173</td>
      <td>-0.043007</td>
      <td>-0.068592</td>
    </tr>
    <tr>
      <th>Humedad Relativa</th>
      <td>-0.326705</td>
      <td>0.984132</td>
      <td>0.983185</td>
      <td>-0.656647</td>
      <td>-0.627314</td>
      <td>1.000000</td>
      <td>-0.222388</td>
      <td>0.158464</td>
      <td>-0.310587</td>
      <td>-0.285112</td>
      <td>-0.272718</td>
    </tr>
    <tr>
      <th>Presion Atmosferica</th>
      <td>0.315755</td>
      <td>-0.198858</td>
      <td>-0.195350</td>
      <td>-0.061698</td>
      <td>-0.087847</td>
      <td>-0.222388</td>
      <td>1.000000</td>
      <td>-0.074028</td>
      <td>0.140169</td>
      <td>0.880074</td>
      <td>0.884014</td>
    </tr>
    <tr>
      <th>Precipitacion</th>
      <td>-0.079645</td>
      <td>0.153376</td>
      <td>0.121833</td>
      <td>-0.040625</td>
      <td>-0.080528</td>
      <td>0.158464</td>
      <td>-0.074028</td>
      <td>1.000000</td>
      <td>0.124105</td>
      <td>-0.066247</td>
      <td>-0.085072</td>
    </tr>
    <tr>
      <th>Rajada Maxima</th>
      <td>0.146310</td>
      <td>-0.294332</td>
      <td>-0.323942</td>
      <td>0.360628</td>
      <td>0.326173</td>
      <td>-0.310587</td>
      <td>0.140169</td>
      <td>0.124105</td>
      <td>1.000000</td>
      <td>0.187934</td>
      <td>0.167328</td>
    </tr>
    <tr>
      <th>Presion Maxima</th>
      <td>0.340376</td>
      <td>-0.255968</td>
      <td>-0.257320</td>
      <td>-0.009466</td>
      <td>-0.043007</td>
      <td>-0.285112</td>
      <td>0.880074</td>
      <td>-0.066247</td>
      <td>0.187934</td>
      <td>1.000000</td>
      <td>0.964624</td>
    </tr>
    <tr>
      <th>Presion Minima</th>
      <td>0.352621</td>
      <td>-0.247689</td>
      <td>-0.240975</td>
      <td>-0.044401</td>
      <td>-0.068592</td>
      <td>-0.272718</td>
      <td>0.884014</td>
      <td>-0.085072</td>
      <td>0.167328</td>
      <td>0.964624</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a contar la cantidad de nans e infs en wind_corr_matrix</span>
<span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">wind_corr_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1">#Remplazar nan con 0s con el fin de usar VIF</span>
<span class="n">wind_corr_matrix</span> <span class="o">=</span> <span class="n">wind_corr_matrix</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a realizar el calculo de VIF para cada variable</span>
<span class="c1">#Primero vamos a crear un dataframe con las variables y su VIF</span>
<span class="n">vif</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_corr_matrix</span><span class="o">.</span><span class="n">columns</span>
<span class="c1">#Ahora calculamos el VIF para cada variable</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;VIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">wind_corr_matrix</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">wind_corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="c1">#Ahora revisamos si la mas alta es mayor a 5</span>
<span class="n">vif</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;VIF&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>variables</th>
      <th>VIF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>Humedad Max</td>
      <td>64818.385031</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Humedad Min</td>
      <td>61427.813095</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Temperatura Max</td>
      <td>49380.443041</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Temperatura Min</td>
      <td>39118.395794</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Humedad Relativa</td>
      <td>16640.302772</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Miramos cuantas columnas tienen un VIF mayor a 5</span>
<span class="n">vif</span><span class="p">[</span><span class="n">vif</span><span class="p">[</span><span class="s1">&#39;VIF&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#El porcentaje de columnas con VIF mayor a 5</span>
<span class="n">vif</span><span class="p">[</span><span class="n">vif</span><span class="p">[</span><span class="s1">&#39;VIF&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">vif</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9090909090909091
</pre></div>
</div>
</div>
</div>
<p>Al ver esto, es posible un error de calculo y no vale la pena eliminar el 90% de nuestras variables. Mejor llevemos a cabo el analisis de correlacion de otra manera.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Veamos un heatmap usando px para ver la correlacion entre las variables</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wind_corr_matrix</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>De esto podemos observar que los valores altos de correlacion se encuentran entre las variables que si estan relacionadas, por ejemplo la Humedad Relativa con sus valores maximos y minimos, lo mismo sucede con la Presion Atmosferica. Podemos reducir la complejidad eliminando los valores maximos y minimos de estas variables y lograr nuestros objetivos con menos columnas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a eliminar las columnas Humedad Max, Humedad Min, Presion Maxima, y Presion Minima</span>
<span class="n">train_wind_2</span> <span class="o">=</span> <span class="n">train_wind_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Humedad Max&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad Min&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Maxima&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Minima&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora veamos nuestro test_wind_2 y eliminamos las mismas columnas</span>
<span class="n">test_wind_2</span> <span class="o">=</span> <span class="n">test_wind_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Humedad Max&#39;</span><span class="p">,</span> <span class="s1">&#39;Humedad Min&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Maxima&#39;</span><span class="p">,</span> <span class="s1">&#39;Presion Minima&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Comparamos tamaños de train_wind_2 y test_wind_2</span>
<span class="n">train_wind_2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(85515, 9)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_wind_2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(8726, 9)
</pre></div>
</div>
</div>
</div>
<p>Con estos datos vamos a llevar a cabo nuestro modelo de Regresion para pronosticar Velocidad.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelo-de-regresion">
<h1>Modelo de Regresion<a class="headerlink" href="#modelo-de-regresion" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Veamos cuantas observaciones tenemos para cada valor de la columna Hora</span>
<span class="n">train_wind_2</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20:00    3674
18:00    3672
16:00    3666
17:00    3665
15:00    3662
19:00    3660
14:00    3647
13:00    3641
12:00    3633
22:00    3624
21:00    3623
23:00    3605
01:00    3588
00:00    3569
11:00    3557
02:00    3544
03:00    3515
04:00    3479
05:00    3452
10:00    3431
06:00    3430
07:00    3413
08:00    3403
09:00    3362
Name: Hora, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Vamos a generar un set de train con las primeras 24 observaciones y un test para las segundas 24 observaciones. La idea es tener datos de un dia para entrenar y datos de otro dia para testear. A partir de un dia pronosticar el siguiente. Luego la idea is pasar a las primeras 48 observaciones para train y las 24 siguientes para test. Ir aumentando asi hasta tener un train de 360 observaciones que representan 15 dias y un test de 24 observaciones que representan 1 dia.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a generar un set de train con las primeras 24 observaciones y un test para las segundas 24 observaciones</span>
<span class="c1">#La idea es tener datos de un dia para entrenar y datos de otro dia para testear</span>
<span class="c1">#A partir de un dia pronosticar el siguiente</span>
<span class="c1">#Luego la idea is pasar a las primeras 48 observaciones para train y las 24 siguientes para test</span>
<span class="c1">#Ir aumentando asi hasta tener un train de 168 observaciones que representan 7 dias y un test de 24 observaciones que representan 1 dia</span>
<span class="c1">#Vamos a evaluar para los siguientes modelos: KNN, Ridge, Lasso, XGBoost, SVM, MLP</span>
<span class="c1">#Vamos a crear un dataframe resultados_regression para guardar los mejores resultados de cada modelo</span>
<span class="c1">#Las columnas son Modelo, MAPE, RMSE, y R2</span>
<span class="n">resultados_regression</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Modelo&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">])</span>
<span class="c1">#Vamos a crear un ciclo que hace cada modelo cambiando el tamaño de train y el que mejor RMSE tenga lo guardamos en resultados_regression</span>
<span class="c1">#Por ejemplo si el KNN con train de 48 observaciones tiene el mejor RMSE, guardamos bajo la columna modelo &quot;KNN 48&quot; y sus valores de desempeño en el resto</span>
</pre></div>
</div>
</div>
</div>
<p>La columna hora la vamos a cambiar empezando en 12:00 por 1, significa que es la primera hora del dia. De esa manera podemos tratar la columna como variable de pronostico.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Haremos una copia de train_wind_2 para poder hacer cambios sin afectar el original</span>
<span class="n">train_wind_3</span> <span class="o">=</span> <span class="n">train_wind_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1">#La columna Hora empieza con valores 12:00 y le corresponde a 1, luego 13:00 le corresponde a 2, etc</span>
<span class="c1">#Vamos a cambiar los valores de Hora para que empiecen en 1 hasta 24</span>
<span class="c1">#Primero vamos a crear una lista con los valores de Hora</span>
<span class="n">horas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">train_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="c1">#Vamos a quitarle el :00 y nos quedamos solo con los primeros dos digitos de la hora</span>
<span class="n">horas_2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">horas</span><span class="p">)):</span>
    <span class="n">horas_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">horas</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span class="n">horas_2</span>
<span class="c1">#Vamos a cambiar los valores de Hora</span>
<span class="n">train_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">horas</span><span class="p">,</span> <span class="n">horas_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Repetimos el proceso para test_wind_2</span>
<span class="n">test_wind_3</span> <span class="o">=</span> <span class="n">test_wind_2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">horas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">horas_2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">horas</span><span class="p">)):</span>
    <span class="n">horas_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">horas</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">horas</span><span class="p">,</span> <span class="n">horas_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora volvemos Hora a numericas</span>
<span class="n">train_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">train_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">])</span>
<span class="n">test_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">test_wind_3</span><span class="p">[</span><span class="s1">&#39;Hora&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Comenzemos con KNN </span>
<span class="c1">#Primero vamos a importar KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="c1">#Vamos a crear un dataframe para guardar los resultados de KNN</span>
<span class="n">resultados_knn</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">])</span>
<span class="c1">#Vamos a crear un ciclo que hace KNN para cada tamaño de train</span>
<span class="c1">#Vamos a usar un tamaño de train de 24 a 168</span>
<span class="c1">#Vamos a usar un tamaño de test de 24</span>
<span class="c1">#Vamos a guardar el RMSE de cada modelo en resultados_knn</span>
<span class="c1">#Comenzemos</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">168</span><span class="p">]:</span>
    <span class="c1">#Primero vamos a crear el set de train y test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="c1">#Ahora vamos a crear el modelo</span>
    <span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">()</span>
    <span class="c1">#Ahora vamos a entrenar el modelo</span>
    <span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a predecir</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a calcular el RMSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">#Ahora vamos a guardar el resultado en resultados_knn</span>
    <span class="n">resultados_knn</span> <span class="o">=</span> <span class="n">resultados_knn</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_knn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Train</th>
      <th>Test</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>24.0</td>
      <td>24.0</td>
      <td>1.033957</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48.0</td>
      <td>24.0</td>
      <td>0.639127</td>
    </tr>
    <tr>
      <th>2</th>
      <td>72.0</td>
      <td>24.0</td>
      <td>0.910741</td>
    </tr>
    <tr>
      <th>3</th>
      <td>96.0</td>
      <td>24.0</td>
      <td>0.880360</td>
    </tr>
    <tr>
      <th>4</th>
      <td>120.0</td>
      <td>24.0</td>
      <td>0.826892</td>
    </tr>
    <tr>
      <th>5</th>
      <td>144.0</td>
      <td>24.0</td>
      <td>0.936340</td>
    </tr>
    <tr>
      <th>6</th>
      <td>168.0</td>
      <td>24.0</td>
      <td>1.132343</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Escogemos el mejor RMSE y con ese hacemos el modelo final para KNN y lo guardamos en resultados_regression</span>
<span class="c1">#El RMSE mas bajo fue con train de 48 observaciones</span>
<span class="c1">#Vamos a crear el set de train y test</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">48</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Usamos los primeros 24 de test_wind_2 para test</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="c1">#Ahora vamos a crear el modelo</span>
<span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">()</span>
<span class="c1">#Ahora vamos a entrenar el modelo</span>
<span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1">#Ahora vamos a predecir</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculamos el desempeño para guardar resultados en resultados_regression</span>
<span class="c1">#Calculamos MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="n">y_test</span><span class="p">))</span>
<span class="c1">#Calculamos RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="c1">#Calculamos R2</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="c1">#Guardamos en resultados_regression</span>
<span class="n">resultados_regression</span> <span class="o">=</span> <span class="n">resultados_regression</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;KNN 48&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a revisar Ridge</span>
<span class="c1">#Primero vamos a importar Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="c1">#Vamos a crear un dataframe para guardar los resultados de Ridge</span>
<span class="n">resultados_ridge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">])</span>
<span class="c1">#Vamos a crear un ciclo que hace Ridge para cada tamaño de train</span>
<span class="c1">#Vamos a usar un tamaño de train de 24 a 168</span>
<span class="c1">#Vamos a usar un tamaño de test de 24</span>
<span class="c1">#Vamos a guardar el RMSE de cada modelo en resultados_ridge</span>
<span class="c1">#Comenzemos</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">168</span><span class="p">]:</span>
    <span class="c1">#Primero vamos a crear el set de train y test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="c1">#Ahora vamos a crear el modelo</span>
    <span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">()</span>
    <span class="c1">#Ahora vamos a entrenar el modelo</span>
    <span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a predecir</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a calcular el RMSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">#Ahora vamos a guardar el resultado en resultados_ridge</span>
    <span class="n">resultados_ridge</span> <span class="o">=</span> <span class="n">resultados_ridge</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_ridge</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Train</th>
      <th>Test</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>24.0</td>
      <td>24.0</td>
      <td>0.490990</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48.0</td>
      <td>24.0</td>
      <td>0.458227</td>
    </tr>
    <tr>
      <th>2</th>
      <td>72.0</td>
      <td>24.0</td>
      <td>0.449504</td>
    </tr>
    <tr>
      <th>3</th>
      <td>96.0</td>
      <td>24.0</td>
      <td>0.394707</td>
    </tr>
    <tr>
      <th>4</th>
      <td>120.0</td>
      <td>24.0</td>
      <td>0.429247</td>
    </tr>
    <tr>
      <th>5</th>
      <td>144.0</td>
      <td>24.0</td>
      <td>0.505533</td>
    </tr>
    <tr>
      <th>6</th>
      <td>168.0</td>
      <td>24.0</td>
      <td>0.591741</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#El menor fue con train de 96 observaciones</span>
<span class="c1">#Vamos a crear el set de train y test</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">96</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Usamos los primeros 24 de test_wind_2 para test</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="c1">#Ahora vamos a crear el modelo</span>
<span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">()</span>
<span class="c1">#Ahora vamos a entrenar el modelo</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1">#Ahora vamos a predecir</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculamos el desempeño para guardar resultados en resultados_regression</span>
<span class="c1">#Calculamos MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="n">y_test</span><span class="p">))</span>
<span class="c1">#Calculamos RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="c1">#Calculamos R2</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="c1">#Guardamos en resultados_regression</span>
<span class="n">resultados_regression</span> <span class="o">=</span> <span class="n">resultados_regression</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;Ridge 96&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a revisar Lasso</span>
<span class="c1">#Primero vamos a importar Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
<span class="c1">#Vamos a crear un dataframe para guardar los resultados de Lasso</span>
<span class="n">resultados_lasso</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">])</span>
<span class="c1">#Vamos a crear un ciclo que hace Lasso para cada tamaño de train</span>
<span class="c1">#Vamos a usar un tamaño de train de 24 a 168</span>
<span class="c1">#Vamos a usar un tamaño de test de 24</span>
<span class="c1">#Vamos a guardar el RMSE de cada modelo en resultados_lasso</span>
<span class="c1">#Comenzemos</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">168</span><span class="p">]:</span>
    <span class="c1">#Primero vamos a crear el set de train y test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="c1">#Ahora vamos a crear el modelo</span>
    <span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">()</span>
    <span class="c1">#Ahora vamos a entrenar el modelo</span>
    <span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a predecir</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a calcular el RMSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">#Ahora vamos a guardar el resultado en resultados_lasso</span>
    <span class="n">resultados_lasso</span> <span class="o">=</span> <span class="n">resultados_lasso</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_lasso</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Train</th>
      <th>Test</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>24.0</td>
      <td>24.0</td>
      <td>1.226494</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48.0</td>
      <td>24.0</td>
      <td>0.707227</td>
    </tr>
    <tr>
      <th>2</th>
      <td>72.0</td>
      <td>24.0</td>
      <td>0.932788</td>
    </tr>
    <tr>
      <th>3</th>
      <td>96.0</td>
      <td>24.0</td>
      <td>0.987514</td>
    </tr>
    <tr>
      <th>4</th>
      <td>120.0</td>
      <td>24.0</td>
      <td>1.025434</td>
    </tr>
    <tr>
      <th>5</th>
      <td>144.0</td>
      <td>24.0</td>
      <td>1.130218</td>
    </tr>
    <tr>
      <th>6</th>
      <td>168.0</td>
      <td>24.0</td>
      <td>0.805828</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#El menor fue con train de 48 observaciones</span>
<span class="c1">#Vamos a crear el set de train y test</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">48</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Usamos los primeros 24 de test_wind_2 para test</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="c1">#Ahora vamos a crear el modelo</span>
<span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">()</span>
<span class="c1">#Ahora vamos a entrenar el modelo</span>
<span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1">#Ahora vamos a predecir</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculamos el desempeño para guardar resultados en resultados_regression</span>
<span class="c1">#Calculamos MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="n">y_test</span><span class="p">))</span>
<span class="c1">#Calculamos RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="c1">#Calculamos R2</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="c1">#Guardamos en resultados_regression</span>
<span class="n">resultados_regression</span> <span class="o">=</span> <span class="n">resultados_regression</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;Lasso 48&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a revisar XGBoost</span>
<span class="c1">#Primero vamos a importar XGBRegressor de sklearn</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="c1">#Vamos a crear un dataframe para guardar los resultados de XGBoost</span>
<span class="n">resultados_xgb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">])</span>
<span class="c1">#Vamos a crear un ciclo que hace XGBoost para cada tamaño de train</span>
<span class="c1">#Vamos a usar un tamaño de train de 24 a 168</span>
<span class="c1">#Vamos a usar un tamaño de test de 24</span>
<span class="c1">#Vamos a guardar el RMSE de cada modelo en resultados_xgb</span>
<span class="c1">#Comenzemos</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">168</span><span class="p">]:</span>
    <span class="c1">#Primero vamos a crear el set de train y test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="c1">#Ahora vamos a crear el modelo</span>
    <span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">()</span>
    <span class="c1">#Ahora vamos a entrenar el modelo</span>
    <span class="n">xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a predecir</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a calcular el RMSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">#Ahora vamos a guardar el resultado en resultados_xgb</span>
    <span class="n">resultados_xgb</span> <span class="o">=</span> <span class="n">resultados_xgb</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_xgb</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Train</th>
      <th>Test</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>24.0</td>
      <td>24.0</td>
      <td>0.723291</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48.0</td>
      <td>24.0</td>
      <td>0.433022</td>
    </tr>
    <tr>
      <th>2</th>
      <td>72.0</td>
      <td>24.0</td>
      <td>0.508024</td>
    </tr>
    <tr>
      <th>3</th>
      <td>96.0</td>
      <td>24.0</td>
      <td>0.537528</td>
    </tr>
    <tr>
      <th>4</th>
      <td>120.0</td>
      <td>24.0</td>
      <td>0.566880</td>
    </tr>
    <tr>
      <th>5</th>
      <td>144.0</td>
      <td>24.0</td>
      <td>0.760675</td>
    </tr>
    <tr>
      <th>6</th>
      <td>168.0</td>
      <td>24.0</td>
      <td>0.497700</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#El mejor fue con train de 48 observaciones</span>
<span class="c1">#Vamos a crear el set de train y test</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">48</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Usamos los primeros 24 de test_wind_2 para test</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="c1">#Ahora vamos a crear el modelo</span>
<span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">()</span>
<span class="c1">#Ahora vamos a entrenar el modelo</span>
<span class="n">xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1">#Ahora vamos a predecir</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculamos el desempeño para guardar resultados en resultados_regression</span>
<span class="c1">#Calculamos MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="n">y_test</span><span class="p">))</span>
<span class="c1">#Calculamos RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="c1">#Calculamos R2</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="c1">#Guardamos en resultados_regression</span>
<span class="n">resultados_regression</span> <span class="o">=</span> <span class="n">resultados_regression</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;XGBoost 48&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a revisar SVM</span>
<span class="c1">#Primero vamos a importar SVR de sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="c1">#Vamos a crear un dataframe para guardar los resultados de SVR</span>
<span class="n">resultados_svr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">])</span>
<span class="c1">#Vamos a crear un ciclo que hace SVR para cada tamaño de train</span>
<span class="c1">#Vamos a usar un tamaño de train de 24 a 168</span>
<span class="c1">#Vamos a usar un tamaño de test de 24</span>
<span class="c1">#Vamos a guardar el RMSE de cada modelo en resultados_svr</span>
<span class="c1">#Comenzemos</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">168</span><span class="p">]:</span>
    <span class="c1">#Primero vamos a crear el set de train y test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="c1">#Ahora vamos a crear el modelo</span>
    <span class="n">svr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">()</span>
    <span class="c1">#Ahora vamos a entrenar el modelo</span>
    <span class="n">svr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a predecir</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a calcular el RMSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">#Ahora vamos a guardar el resultado en resultados_svr</span>
    <span class="n">resultados_svr</span> <span class="o">=</span> <span class="n">resultados_svr</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_svr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Train</th>
      <th>Test</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>24.0</td>
      <td>24.0</td>
      <td>1.227505</td>
    </tr>
    <tr>
      <th>1</th>
      <td>48.0</td>
      <td>24.0</td>
      <td>0.799118</td>
    </tr>
    <tr>
      <th>2</th>
      <td>72.0</td>
      <td>24.0</td>
      <td>1.058214</td>
    </tr>
    <tr>
      <th>3</th>
      <td>96.0</td>
      <td>24.0</td>
      <td>1.187703</td>
    </tr>
    <tr>
      <th>4</th>
      <td>120.0</td>
      <td>24.0</td>
      <td>1.177261</td>
    </tr>
    <tr>
      <th>5</th>
      <td>144.0</td>
      <td>24.0</td>
      <td>1.377451</td>
    </tr>
    <tr>
      <th>6</th>
      <td>168.0</td>
      <td>24.0</td>
      <td>1.034751</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#El mejor fue con train de 48 observaciones</span>
<span class="c1">#Vamos a crear el set de train y test</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">48</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Usamos los primeros 24 de test_wind_2 para test</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="c1">#Ahora vamos a crear el modelo</span>
<span class="n">svr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">()</span>
<span class="c1">#Ahora vamos a entrenar el modelo</span>
<span class="n">svr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1">#Ahora vamos a predecir</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculamos el desempeño para guardar resultados en resultados_regression</span>
<span class="c1">#Calculamos MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="n">y_test</span><span class="p">))</span>
<span class="c1">#Calculamos RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="c1">#Calculamos R2</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="c1">#Guardamos en resultados_regression</span>
<span class="n">resultados_regression</span> <span class="o">=</span> <span class="n">resultados_regression</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;SVM 48&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora vamos a revisar MLP</span>
<span class="c1">#Usemos random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">499</span><span class="p">)</span>
<span class="c1">#Primero vamos a importar MLPRegressor de sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPRegressor</span>
<span class="c1">#Vamos a crear un dataframe para guardar los resultados de MLP</span>
<span class="n">resultados_mlp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">])</span>
<span class="c1">#Vamos a crear un ciclo que hace MLP para cada tamaño de train</span>
<span class="c1">#Vamos a usar un tamaño de train de 24 a 168</span>
<span class="c1">#Vamos a usar un tamaño de test de 24</span>
<span class="c1">#Vamos a guardar el RMSE de cada modelo en resultados_mlp</span>
<span class="c1">#Comenzemos</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">168</span><span class="p">]:</span>
    <span class="c1">#Primero vamos a crear el set de train y test</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
    <span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
    <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
    <span class="c1">#Ahora vamos a crear el modelo</span>
    <span class="n">mlp</span> <span class="o">=</span> <span class="n">MLPRegressor</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">learning_rate_init</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a entrenar el modelo</span>
    <span class="n">mlp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a predecir</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="c1">#Ahora vamos a calcular el RMSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">#Ahora vamos a guardar el resultado en resultados_mlp</span>
    <span class="n">resultados_mlp</span> <span class="o">=</span> <span class="n">resultados_mlp</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Train&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;Test&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Usemos random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>
<span class="c1">#El mejor fue con train de 96 observaciones</span>
<span class="c1">#Vamos a crear el set de train y test</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">96</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Usamos los primeros 24 de test_wind_2 para test</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test_wind_3</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
<span class="c1">#Ahora vamos a crear X_train, y_train, X_test, y_test</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;Velocidad&#39;</span><span class="p">]</span>
<span class="c1">#Ahora vamos a crear el modelo</span>
<span class="n">mlp</span> <span class="o">=</span> <span class="n">MLPRegressor</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">learning_rate_init</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="c1">#Ahora vamos a entrenar el modelo</span>
<span class="n">mlp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1">#Ahora vamos a predecir</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculamos el desempeño para guardar resultados en resultados_regression</span>
<span class="c1">#Calculamos MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">/</span><span class="n">y_test</span><span class="p">))</span>
<span class="c1">#Calculamos RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="c1">#Calculamos R2</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="c1">#Guardamos en resultados_regression</span>
<span class="n">resultados_regression</span> <span class="o">=</span> <span class="n">resultados_regression</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Modelo&#39;</span><span class="p">:</span> <span class="s1">&#39;MLP 96&#39;</span><span class="p">,</span> <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="n">mape</span><span class="p">,</span> <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span> <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados_regression</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>MAPE</th>
      <th>RMSE</th>
      <th>R2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KNN 48</td>
      <td>0.389324</td>
      <td>1.578264</td>
      <td>-2.712015</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ridge 96</td>
      <td>0.590210</td>
      <td>2.007932</td>
      <td>-5.008256</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lasso 48</td>
      <td>0.359294</td>
      <td>1.430733</td>
      <td>-2.050477</td>
    </tr>
    <tr>
      <th>3</th>
      <td>XGBoost 48</td>
      <td>0.196452</td>
      <td>0.951838</td>
      <td>-0.350132</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SVM 48</td>
      <td>0.444494</td>
      <td>1.736982</td>
      <td>-3.496153</td>
    </tr>
    <tr>
      <th>5</th>
      <td>MLP 96</td>
      <td>0.404304</td>
      <td>1.475985</td>
      <td>-2.246492</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>El mejor desempeño se puede observar que lo obtuvo XGBoost con 48 horas de training.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelo-de-clasificacion">
<h1>Modelo de Clasificacion<a class="headerlink" href="#modelo-de-clasificacion" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Se reciben los sets tr_train_2 y tr_test_2</span>
<span class="c1">#Vamos a realizar modelos de clasificacion para predecir isFraud</span>
<span class="c1">#Usaremos los siguientes modelos : K-NN, Ridge, Lasso, Naive Bayes, XGBoost, SVM, y MLP</span>
<span class="c1">#La idea es armar una tabla de error que mida precision, recall, f1, y AUC para cada modelo</span>
<span class="c1">#La idea es usar GridSearchCV y Pipeline para optimizar los hiperparametros de cada modelo y evaluarlos</span>
<span class="c1">#Vamos a usar cross validation con 3 folds stratificados</span>
<span class="c1">#Vamos a usar como metrica de optimizacion el AUC</span>
<span class="c1">#Vamos a usar como metricas de evaluacion precision, recall, f1, y AUC</span>
<span class="c1">#Vamos a usar como metrica de comparacion el AUC</span>
<span class="c1">#Creemos un dataframe para guardar los resultados</span>
<span class="n">resultados</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Modelo&#39;</span><span class="p">,</span><span class="s1">&#39;Precision&#39;</span><span class="p">,</span><span class="s1">&#39;Recall&#39;</span><span class="p">,</span><span class="s1">&#39;F1&#39;</span><span class="p">,</span><span class="s1">&#39;AUC&#39;</span><span class="p">])</span>
<span class="c1">#Primero vamos a separar las variables de respuesta de las explicativas</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">tr_train_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">])</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">tr_train_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">tr_test_2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">tr_test_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Por cuestion de tiempo vamos a usar solo 10000 observaciones de train para entrenar los modelos</span>
<span class="c1">#La idea es mantener la proporcion de 0 y 1 en isFraud</span>
<span class="c1">#Vamos a usar sample para tomar 10000 observaciones en tr_train_2</span>
<span class="c1">#Ya que se tienen pocos 1, vamos a tomar 10000 observaciones de 0 y 10000 de 1</span>
<span class="n">tr_train_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="c1">#Vemos que hay 569877 observaciones de 0 y 20663 de 1</span>
<span class="c1">#Usamos 10000 de 0 y 10000 de 1</span>
<span class="n">tr_train_2_0</span> <span class="o">=</span> <span class="n">tr_train_2</span><span class="p">[</span><span class="n">tr_train_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">tr_train_2_1</span> <span class="o">=</span> <span class="n">tr_train_2</span><span class="p">[</span><span class="n">tr_train_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="c1">#Combinamos los dos sets</span>
<span class="n">tr_train_2_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tr_train_2_0</span><span class="p">,</span> <span class="n">tr_train_2_1</span><span class="p">])</span>
<span class="c1">#Vamos a mezclar las observaciones</span>
<span class="n">tr_train_2_sample</span> <span class="o">=</span> <span class="n">tr_train_2_sample</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="c1">#Vamos a separar las variables de respuesta de las explicativas</span>
<span class="n">x_train_sample</span> <span class="o">=</span> <span class="n">tr_train_2_sample</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">])</span>
<span class="n">y_train_sample</span> <span class="o">=</span> <span class="n">tr_train_2_sample</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora creamos x_test y y_test a partir de tr_test_2 de la misma manera</span>
<span class="n">tr_test_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="c1">#Usamos 4000 y 4000</span>
<span class="n">tr_test_2_0</span> <span class="o">=</span> <span class="n">tr_test_2</span><span class="p">[</span><span class="n">tr_test_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">tr_test_2_1</span> <span class="o">=</span> <span class="n">tr_test_2</span><span class="p">[</span><span class="n">tr_test_2</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="c1">#Combinamos los dos sets</span>
<span class="n">tr_test_2_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">tr_test_2_0</span><span class="p">,</span> <span class="n">tr_test_2_1</span><span class="p">])</span>
<span class="c1">#Vamos a mezclar las observaciones</span>
<span class="n">tr_test_2_sample</span> <span class="o">=</span> <span class="n">tr_test_2_sample</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="c1">#Vamos a separar las variables de respuesta de las explicativas</span>
<span class="n">x_test_sample</span> <span class="o">=</span> <span class="n">tr_test_2_sample</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">])</span>
<span class="n">y_test_sample</span> <span class="o">=</span> <span class="n">tr_test_2_sample</span><span class="p">[</span><span class="s1">&#39;isFraud&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a crear un GridSearchCV para KNN sin Pipeline   </span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="c1">#Vamos a crear un diccionario con los hiperparametros</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">25</span><span class="p">]}</span>
<span class="c1">#Vamos a crear el GridSearchCV</span>
<span class="n">knn_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">KNeighborsClassifier</span><span class="p">(),</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
<span class="c1">#Vamos a entrenar el modelo</span>
<span class="n">knn_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=StratifiedKFold(n_splits=3, random_state=None, shuffle=False),
             estimator=KNeighborsClassifier(),
             param_grid={&#39;n_neighbors&#39;: [3, 5, 8, 12, 15, 20, 25]},
             scoring=&#39;roc_auc&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a usar el mejor modelo para predecir en el set de test</span>
<span class="c1">#Primero vamos a ver el mejor modelo</span>
<span class="n">knn_grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
<span class="c1">#Vamos a predecir en el set de test</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn_grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_sample</span><span class="p">)</span>
<span class="c1">#Agregamos resultados en el dataframe</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;KNN&#39;</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;F1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;AUC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora para el modelo Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">RidgeClassifier</span>
<span class="c1">#Vamos a crear un diccionario con los hiperparametros</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">]}</span>
<span class="c1">#Vamos a crear el GridSearchCV</span>
<span class="n">ridge_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">RidgeClassifier</span><span class="p">(),</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
<span class="c1">#Vamos a entrenar el modelo</span>
<span class="n">ridge_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=3.53973e-19): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=3.54029e-19): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=3.48526e-19): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=1.76987e-18): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=1.77014e-18): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=1.74263e-18): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=3.53973e-18): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=3.54029e-18): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=3.48526e-18): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=7.07946e-18): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=7.08057e-18): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=6.97052e-18): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=1.76987e-17): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=1.77014e-17): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=1.74263e-17): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=2.48998e-17): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=2.35643e-17): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=3.48526e-17): result may not be accurate.

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_ridge.py:157: LinAlgWarning:

Ill-conditioned matrix (rcond=2.34771e-17): result may not be accurate.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=StratifiedKFold(n_splits=3, random_state=None, shuffle=False),
             estimator=RidgeClassifier(),
             param_grid={&#39;alpha&#39;: [0.1, 0.5, 1, 2, 5, 10]}, scoring=&#39;roc_auc&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a usar el mejor modelo para predecir en el set de test</span>
<span class="c1">#Primero vamos a ver el mejor modelo</span>
<span class="n">ridge_grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
<span class="c1">#Vamos a predecir en el set de test</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridge_grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_sample</span><span class="p">)</span>
<span class="c1">#Agregamos resultados en el dataframe</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Ridge&#39;</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;F1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;AUC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ahora para el modelo Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
<span class="c1">#Vamos a crear un diccionario con los hiperparametros</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.0001</span><span class="p">]}]</span>
<span class="c1">#Vamos a crear el GridSearchCV</span>
<span class="n">lasso_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">Lasso</span><span class="p">(),</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
<span class="c1">#Vamos a entrenar el modelo</span>
<span class="n">lasso_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.219e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.257e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.149e+03, tolerance: 3.334e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.294e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.318e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.250e+03, tolerance: 3.334e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.350e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.358e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.338e+03, tolerance: 3.334e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.281e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.284e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.281e+03, tolerance: 3.334e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.210e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.215e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.214e+03, tolerance: 3.334e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.183e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.188e+03, tolerance: 3.333e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.186e+03, tolerance: 3.334e-01

c:\Users\USUARIO\miniconda3\envs\ml_venv\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 1.786e+03, tolerance: 5.000e-01
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=StratifiedKFold(n_splits=3, random_state=None, shuffle=False),
             estimator=Lasso(),
             param_grid=[{&#39;alpha&#39;: [1, 0.5, 0.1, 0.01, 0.001, 0.0001]}],
             scoring=&#39;roc_auc&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a usar el mejor modelo para predecir en el set de test</span>
<span class="c1">#Primero vamos a ver el mejor modelo</span>
<span class="n">lasso_grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
<span class="c1">#Vamos a predecir en el set de test</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lasso_grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Agregamos resultados en el dataframe</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Lasso&#39;</span>
<span class="c1">#Para calcular los parametros de precision, recall, f1, y AUC vamos a usar un umbral de 0.5</span>
<span class="n">y_pred_05</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred_05</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred_05</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;F1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred_05</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;AUC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Modelo Naive Bayes</span>
<span class="c1">#Para este modelo no vamos a iterar Parametros ni hacer GridSearchCV</span>
<span class="c1">#Vamos a generar el modelo con GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="c1">#Vamos a entrenar el modelo</span>
<span class="n">gaussian</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
<span class="n">gaussian</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
<span class="c1">#Vamos a predecir en el set de test</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">gaussian</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Agregamos los resultados en el dataframe</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Naive Bayes&#39;</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;Precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;Recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;F1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;AUC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Modelo XGBoost</span>
<span class="c1">#Importamos el modelo</span>
<span class="c1">#XGBoost from sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingClassifier</span>
<span class="c1">#Vamos a crear un diccionario con los hiperparametros</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span> <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">]}</span>
<span class="c1">#Vamos a crear el GridSearchCV</span>
<span class="n">xgb_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">GradientBoostingClassifier</span><span class="p">(),</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
<span class="c1">#Vamos a entrenar el modelo</span>
<span class="n">xgb_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=StratifiedKFold(n_splits=3, random_state=None, shuffle=False),
             estimator=GradientBoostingClassifier(),
             param_grid={&#39;learning_rate&#39;: [0.1, 0.5, 1, 2],
                         &#39;max_depth&#39;: [3, 5, 8, 12],
                         &#39;n_estimators&#39;: [50, 100, 200, 300]},
             scoring=&#39;roc_auc&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Predecimos en test</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">xgb_grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Agregamos los resultados en el dataframe</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;XGBoost&#39;</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;F1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;AUC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Modelo SVM</span>
<span class="c1">#Importamos el modelo</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="c1">#Vamos a crear un diccionario con los hiperparametros</span>
<span class="c1">#param_grid = {&#39;C&#39;: [0.1,0.5,1,2,5,10], &#39;kernel&#39;: [&#39;linear&#39;,&#39;poly&#39;,&#39;rbf&#39;,&#39;sigmoid&#39;]}</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">],</span> <span class="s1">&#39;kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">]}</span>
<span class="c1">#Vamos a crear el GridSearchCV</span>
<span class="n">svm_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">SVC</span><span class="p">(),</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
<span class="c1">#Vamos a entrenar el modelo</span>
<span class="n">svm_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vamos a hacer un modelo SVC sin gridsearch por cuestiones de tiempo de procesamiento</span>
<span class="c1">#Vamos a entrenar el modelo</span>
<span class="c1">#Importamos el modelo</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="n">svm</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">()</span>
<span class="n">svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SVC()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Predecimos con test el svc</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Agregamos los resultados en el dataframe</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SVM&#39;</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;F1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;AUC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Por Ulitmo el modelo MLP</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="c1">#Vamos a crear un diccionario con los hiperparametros</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hidden_layer_sizes&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">10</span><span class="p">,),(</span><span class="mi">50</span><span class="p">,),(</span><span class="mi">100</span><span class="p">,)],</span> <span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;identity&#39;</span><span class="p">,</span><span class="s1">&#39;logistic&#39;</span><span class="p">,</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span><span class="s1">&#39;relu&#39;</span><span class="p">]}</span>
<span class="c1">#Vamos a crear el GridSearchCV</span>
<span class="n">mlp_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">MLPClassifier</span><span class="p">(),</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">)</span>
<span class="c1">#Vamos a entrenar el modelo</span>
<span class="n">mlp_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train_sample</span><span class="p">,</span> <span class="n">y_train_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=StratifiedKFold(n_splits=3, random_state=None, shuffle=False),
             estimator=MLPClassifier(),
             param_grid={&#39;activation&#39;: [&#39;identity&#39;, &#39;logistic&#39;, &#39;tanh&#39;, &#39;relu&#39;],
                         &#39;hidden_layer_sizes&#39;: [(10,), (50,), (100,)]},
             scoring=&#39;roc_auc&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Predecimos para test con el MLP</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">mlp_grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Agregamos los resultados en el dataframe</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Modelo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MLP&#39;</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;F1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">resultados</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;AUC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_test_sample</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resultados</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Modelo</th>
      <th>Precision</th>
      <th>Recall</th>
      <th>F1</th>
      <th>AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KNN</td>
      <td>0.353641</td>
      <td>0.63125</td>
      <td>0.453321</td>
      <td>0.584875</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ridge</td>
      <td>0.552941</td>
      <td>0.76375</td>
      <td>0.64147</td>
      <td>0.758375</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lasso</td>
      <td>0.550045</td>
      <td>0.7625</td>
      <td>0.639078</td>
      <td>0.818845</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Naive Bayes</td>
      <td>0.300278</td>
      <td>0.94625</td>
      <td>0.455887</td>
      <td>0.532125</td>
    </tr>
    <tr>
      <th>4</th>
      <td>XGBoost</td>
      <td>0.732768</td>
      <td>0.86375</td>
      <td>0.792886</td>
      <td>0.868875</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SVM</td>
      <td>0.302409</td>
      <td>0.7375</td>
      <td>0.428935</td>
      <td>0.5285</td>
    </tr>
    <tr>
      <th>6</th>
      <td>MLP</td>
      <td>0.320371</td>
      <td>0.90625</td>
      <td>0.473392</td>
      <td>0.568625</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Observando los resultados obtenidos con todos los modelos, vemos que el mejor desempeño se obtiene utilizando el modelo classificador de Gradient Boosting.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Este es el Examen Parcial de Machine Learning de Augusto Piñeres</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Parcial Machine Learning Augusto Piñeres</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fraud-detection">Fraud Detection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wind-speed">Wind Speed</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion">Modelo de Regresion</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion">Modelo de Clasificacion</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Augusto Piñeres
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>